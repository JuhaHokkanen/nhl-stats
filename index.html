<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NHL Kierrosraportti + Videot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; }
    </style>
</head>
<body class="text-slate-200 p-4 sm:p-8 min-h-screen">

    <div class="max-w-xl mx-auto">
        <header class="mb-12 text-center">
            <h1 class="text-xs font-black uppercase tracking-[0.3em] text-slate-500 mb-2">NHL Maalikoosteet</h1>
            <div class="flex items-center justify-between bg-slate-900/50 rounded-full p-1 border border-slate-800 shadow-lg">
                <button onclick="changeDate(-1)" class="w-10 h-10 flex items-center justify-center hover:bg-slate-800 rounded-full transition-all text-slate-400">←</button>
                <input type="date" id="datePicker" onchange="selectDate(this.value)" class="bg-transparent text-sm font-bold text-white outline-none cursor-pointer px-4">
                <button onclick="changeDate(1)" class="w-10 h-10 flex items-center justify-center hover:bg-slate-800 rounded-full transition-all text-slate-400">→</button>
            </div>
        </header>

        <div id="loading" class="hidden text-center py-20 text-slate-500 text-[10px] font-bold uppercase tracking-[0.2em]">Päivitetään otteluita...</div>
        <div id="resultsContainer" class="space-y-12"></div>
    </div>

    <script>
        let currentDate = new Date();
        currentDate.setHours(currentDate.getHours() - 8);
        document.getElementById('datePicker').value = currentDate.toISOString().split('T')[0];

        function selectDate(val) { currentDate = new Date(val); fetchNHLResults(); }
        function changeDate(days) { 
            currentDate.setDate(currentDate.getDate() + days); 
            document.getElementById('datePicker').value = currentDate.toISOString().split('T')[0];
            fetchNHLResults(); 
        }

        async function fetchNHLResults() {
            const container = document.getElementById('resultsContainer');
            const loadingDiv = document.getElementById('loading');
            const dateStr = currentDate.toISOString().split('T')[0];
            
            container.innerHTML = '';
            loadingDiv.classList.remove('hidden');

            try {
                const url = `https://corsproxy.io/?${encodeURIComponent('https://api-web.nhle.com/v1/score/' + dateStr)}`;
                const response = await fetch(url);
                const data = await response.json();
                const games = data.games || [];
                loadingDiv.classList.add('hidden');

                if (games.length === 0) {
                    container.innerHTML = `<div class="text-center text-slate-600 text-xs font-medium italic">Ei otteluita tänä päivänä.</div>`;
                    return;
                }

                games.forEach(game => {
                    const gameSection = document.createElement('div');
                    gameSection.className = "animate-in slide-in-from-bottom-2 duration-500";
                    
                    let html = `
                        <div class="flex items-center justify-between border-b border-slate-800 pb-4 mb-6">
                            <div class="flex gap-4 items-center">
                                <span class="text-xl font-extrabold text-white tracking-tighter">${game.awayTeam.abbrev} @ ${game.homeTeam.abbrev}</span>
                            </div>
                            <div class="text-2xl font-black text-slate-400 tabular-nums">
                                <span>${game.awayTeam.score} - ${game.homeTeam.score}</span>
                            </div>
                        </div>
                        <div class="space-y-8">`;

                    if (game.goals && game.goals.length > 0) {
                        game.goals.forEach(goal => {
                            let assistNames = [];
                            if (goal.assists) {
                                goal.assists.forEach(asst => {
                                    assistNames.push(asst.name?.default || asst.name);
                                });
                            }

                            // VIDEO-LINKIN MUODOSTAMINEN
                            // NHL käyttää yleensä muotoa https://www.nhl.com/video/[clipId]
                            const videoUrl = goal.highlightClip 
                                ? `https://www.nhl.com/video/t-${game.id}/c-${goal.highlightClip}` 
                                : `https://www.nhl.com/video/search?q=${goal.firstName.default}+${goal.lastName.default}`;

                            html += `
                                <div class="relative pl-4 border-l-2 border-slate-800 group">
                                    <div class="flex justify-between items-baseline mb-1">
                                        <h4 class="text-sm font-bold text-slate-200">
                                            ${goal.firstName.default} ${goal.lastName.default}
                                            <span class="text-[10px] text-slate-600 font-normal ml-2 uppercase tracking-tighter">${goal.teamAbbrev.default || goal.teamAbbrev}</span>
                                        </h4>
                                        <span class="text-[10px] font-mono text-slate-600">${goal.timeInPeriod}</span>
                                    </div>
                                    <p class="text-[11px] text-slate-500 italic mb-2">
                                        ${assistNames.length > 0 ? assistNames.join(', ') : 'Ilman syöttäjiä'}
                                    </p>
                                    <a href="${videoUrl}" target="_blank" class="inline-flex items-center text-[9px] font-black uppercase tracking-widest text-blue-500 hover:text-blue-400 transition-colors">
                                        Katso video <span class="ml-1">→</span>
                                    </a>
                                </div>`;
                        });
                    } else {
                        html += `<p class="text-[10px] text-slate-700 italic uppercase">Ei maaleja raportoitu</p>`;
                    }

                    html += `</div>`;
                    gameSection.innerHTML = html;
                    container.appendChild(gameSection);
                });

            } catch (err) {
                loadingDiv.innerHTML = "VIRHE TIETOJEN HAUSSA.";
            }
        }
        fetchNHLResults();
    </script>
</body>
</html>